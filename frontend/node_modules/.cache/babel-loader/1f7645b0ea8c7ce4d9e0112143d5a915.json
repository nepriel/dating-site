{"ast":null,"code":"var _jsxFileName = \"/usr/src/app/src/components/pages/Suggestion/SuggestionList.js\";\nimport React, { Component } from 'react';\nimport { Range } from 'rc-slider';\nimport Select from 'react-select';\nimport { GetUserIntrests } from '../../../store/actions/intrestsActions/GetAllInterestsAction';\nimport { connect } from \"react-redux\";\nimport { push } from \"react-router-redux\";\nimport ResultUser from './../Dashboard/ResultUser';\nimport sort from 'fast-sort';\nexport class SuggestionList extends Component {\n  constructor(props) {\n    super(props);\n\n    this.onLowerBoundChange = e => {\n      this.setState({\n        lowerBound: +e.target.value\n      });\n    };\n\n    this.onUpperBoundChange = e => {\n      this.setState({\n        upperBound: +e.target.value\n      });\n    };\n\n    this.onSliderChange = async value => {\n      this.setState({\n        value\n      });\n      await this.filterUsers(); // console.log(this.state.value);\n    };\n\n    this.handleApply = () => {\n      const _this$state = this.state,\n            lowerBound = _this$state.lowerBound,\n            upperBound = _this$state.upperBound;\n      this.setState({\n        value: [lowerBound, upperBound]\n      });\n    };\n\n    this.handleSelectChange = selectedOption => {\n      this.setState({\n        selectedOption\n      });\n      setTimeout(async () => {\n        await this.filterUsers();\n      }, 50);\n    };\n\n    this.onChange = async e => {\n      if (e.target.name !== 'sortBy') {\n        e.preventDefault();\n      }\n\n      this.setState({\n        [e.target.name]: e.target.value\n      });\n      setTimeout(async () => {\n        await this.filterUsers();\n      }, 50); // await this.filterUsers();\n      // console.log(this.state[e.target.name]);\n    };\n\n    this.state = {\n      sortBy: 'age',\n      lowerBound: 18,\n      upperBound: 75,\n      value: [18, 75],\n      SearchBar: '',\n      rangeFame: 0,\n      rangeLocalisation: 10000,\n      SearchBarTags: '',\n      interestsArray: [],\n      selectedOption: [],\n      location: \"\",\n      initialUsers: this.props.users,\n      userBuffer: []\n    };\n    this.handleUsersFilter = this.handleUsersFilter.bind(this);\n    this.onChange = this.onChange.bind(this);\n    this.handleSelectChange = this.handleSelectChange.bind(this);\n  }\n\n  async handleUsersFilter(e) {\n    e.preventDefault();\n    let filter = [{\n      userPos: this.state.location,\n      rangeFame: this.state.rangeFame,\n      age: this.state.value,\n      interests: this.state.selectedOption,\n      rangeLocalisation: parseInt(this.state.rangeLocalisation)\n    }];\n    await this.props.onfetchAllUsersPublicData(filter);\n  }\n\n  async UNSAFE_componentWillMount() {\n    const userId = localStorage.getItem(\"userId\");\n    this.setState({\n      interestsArray: this.props.interestsArray\n    });\n    await this.props.onGetUserIntrests(userId);\n    await this.filterUsers();\n  }\n\n  async filterUsers() {\n    let buffer = [];\n    buffer = this.state.initialUsers; //FILTER\n    //filter by age\n\n    var AgeMin = this.state.value[0];\n    var AgeMax = this.state.value[1];\n    var tmpbuff = [];\n    buffer.forEach(user => {\n      if (user.age >= AgeMin && user.age <= AgeMax) {\n        tmpbuff.push(user);\n      }\n    });\n    buffer = tmpbuff; //filter by fame\n\n    var fame = this.state.rangeFame;\n    var tmpbuff = [];\n    buffer.forEach(user => {\n      if (user.fame >= fame) {\n        tmpbuff.push(user);\n      }\n    });\n    buffer = tmpbuff; //filter by dist\n\n    var dist = this.state.rangeLocalisation;\n    var tmpbuff = [];\n    buffer.forEach(user => {\n      if (user.distance <= dist) {\n        tmpbuff.push(user);\n      }\n    });\n    buffer = tmpbuff; //filter by interests\n\n    var tagss = [];\n    var tmpbuff = [];\n\n    if (this.state.selectedOption !== null) {\n      this.state.selectedOption.forEach(element => {\n        tagss.push(element.value);\n      });\n    }\n\n    if (tagss.length !== 0) {\n      buffer.forEach(element => {\n        element.tags.forEach(tag => {\n          tagss.forEach(filter_tag => {\n            if (filter_tag === tag) {\n              tmpbuff.push(element);\n            }\n          });\n        });\n      });\n      buffer = tmpbuff;\n    } //SORT\n    //sort by fame and age\n\n\n    if (this.state.sortBy === 'fame' || this.state.sortBy === 'age') {\n      buffer = sort(buffer).asc(u => u[this.state.sortBy]);\n      this.setState({\n        userBuffer: buffer\n      }); //sort by distance\n    } else if (this.state.sortBy === 'location') {\n      buffer = sort(buffer).asc(u => u.distance);\n      this.setState({\n        userBuffer: buffer\n      }); //sort by tags\n    } else if (this.state.sortBy === 'tags') {\n      //on a une liste de tags.\n      //on veut que les utilisateurs qui ont le premier element de la liste de tags arrive en premier puis les deuxieme arrive ensuite\n      var tags = [];\n\n      if (this.state.interestsArray !== null) {\n        this.state.interestsArray.forEach(element => {\n          tags.push(element.value);\n        });\n      }\n\n      var newbuffer = [];\n      tags.forEach(tagfromlist => {\n        buffer.forEach(element => {\n          element.tags.forEach(taguser => {\n            if (taguser === tagfromlist) {\n              newbuffer.push(element);\n            }\n          });\n        });\n      });\n      buffer = newbuffer;\n      this.setState({\n        userBuffer: buffer\n      });\n    }\n  }\n\n  render() {\n    let filteredUsers = this.state.userBuffer;\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198\n      },\n      __self: this\n    }, React.createElement(\"form\", {\n      style: {\n        'marginBottom': '2rem'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"\",\n      style: {\n        display: 'flex',\n        'justifyContent': 'space-around'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"\",\n      style: filterStyle,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201\n      },\n      __self: this\n    }, React.createElement(\"h4\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202\n      },\n      __self: this\n    }, \"Age\"), React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203\n      },\n      __self: this\n    }, \"from \", this.state.value[0], \" to \", this.state.value[1]), React.createElement(Range, {\n      allowCross: false,\n      value: this.state.value,\n      onChange: this.onSliderChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208\n      },\n      __self: this\n    }), React.createElement(\"h4\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210\n      },\n      __self: this\n    }, \"Fame\"), React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211\n      },\n      __self: this\n    }, \"search users above \", this.state.rangeFame, \" Fame\"), React.createElement(\"input\", {\n      type: \"range\",\n      className: \"custom-range\",\n      id: \"rangeFame\",\n      name: \"rangeFame\",\n      min: \"0\",\n      max: \"100\",\n      value: this.state.rangeFame,\n      onChange: this.onChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"\",\n      style: filterStyle,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214\n      },\n      __self: this\n    }, React.createElement(\"h4\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215\n      },\n      __self: this\n    }, \"Localisation\"), React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216\n      },\n      __self: this\n    }, \"search users \", this.state.rangeLocalisation, \"km\", \"\".concat(this.state.rangeLocalisation > 1 ? 's' : ''), \" from you\"), React.createElement(\"input\", {\n      type: \"range\",\n      className: \"custom-range\",\n      id: \"rangeLocalisation\",\n      name: \"rangeLocalisation\",\n      min: \"1\",\n      max: \"10000\",\n      value: this.state.rangeLocalisation,\n      onChange: this.onChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217\n      },\n      __self: this\n    }), React.createElement(\"h4\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218\n      },\n      __self: this\n    }, \"Interests\"), React.createElement(Select, {\n      isMulti: true,\n      isSearchable: true,\n      placeholder: \"Filter interests\",\n      value: this.state.selectedOption,\n      onChange: this.handleSelectChange,\n      options: this.state.interestsArray,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219\n      },\n      __self: this\n    }))), React.createElement(\"div\", {\n      style: {\n        padding: '2rem'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      style: {\n        backgroundColor: 'grey',\n        height: '2rem',\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230\n      },\n      __self: this\n    }, \" \", React.createElement(\"h4\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230\n      },\n      __self: this\n    }, \"SORT BY\")), React.createElement(\"div\", {\n      style: {\n        backgroundColor: 'grey',\n        height: '5rem',\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      style: somemargin,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233\n      },\n      __self: this\n    }, \"Age\"), React.createElement(\"input\", {\n      type: \"radio\",\n      name: \"sortBy\",\n      value: \"age\",\n      checked: this.state.sortBy === 'age',\n      onChange: this.onChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      style: somemargin,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237\n      },\n      __self: this\n    }, \"Distance\"), React.createElement(\"input\", {\n      type: \"radio\",\n      name: \"sortBy\",\n      value: \"location\",\n      checked: this.state.sortBy === 'location',\n      onChange: this.onChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      style: somemargin,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 240\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 241\n      },\n      __self: this\n    }, \"Tags\"), React.createElement(\"input\", {\n      type: \"radio\",\n      name: \"sortBy\",\n      value: \"tags\",\n      checked: this.state.sortBy === 'tags',\n      onChange: this.onChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      style: somemargin,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 244\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245\n      },\n      __self: this\n    }, \"Fame\"), React.createElement(\"input\", {\n      type: \"radio\",\n      name: \"sortBy\",\n      value: \"fame\",\n      checked: this.state.sortBy === 'fame',\n      onChange: this.onChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246\n      },\n      __self: this\n    }))))), React.createElement(ResultUser, {\n      users: filteredUsers,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 252\n      },\n      __self: this\n    }));\n  }\n\n}\nconst somemargin = {\n  textAlign: 'center',\n  width: '24%'\n};\nconst filterStyle = {\n  width: '45%',\n  float: 'left',\n  padding: '1rem',\n  'backgroundColor': 'lightgray',\n  'marginTop': '2rem'\n};\n\nconst state = (state, ownProps = {}) => {\n  return {\n    getUserInterests: state.getUserInterests.getUserInterests\n  };\n};\n\nconst mapDispatchToProps = (dispatch, ownProps) => {\n  return {\n    navigateTo: location => {\n      dispatch(push(location));\n    },\n    onGetUserIntrests: userId => dispatch(GetUserIntrests(userId))\n  };\n};\n\nexport default connect(state, mapDispatchToProps)(SuggestionList);","map":{"version":3,"sources":["/usr/src/app/src/components/pages/Suggestion/SuggestionList.js"],"names":["React","Component","Range","Select","GetUserIntrests","connect","push","ResultUser","sort","SuggestionList","constructor","props","onLowerBoundChange","e","setState","lowerBound","target","value","onUpperBoundChange","upperBound","onSliderChange","filterUsers","handleApply","state","handleSelectChange","selectedOption","setTimeout","onChange","name","preventDefault","sortBy","SearchBar","rangeFame","rangeLocalisation","SearchBarTags","interestsArray","location","initialUsers","users","userBuffer","handleUsersFilter","bind","filter","userPos","age","interests","parseInt","onfetchAllUsersPublicData","UNSAFE_componentWillMount","userId","localStorage","getItem","onGetUserIntrests","buffer","AgeMin","AgeMax","tmpbuff","forEach","user","fame","dist","distance","tagss","element","length","tags","tag","filter_tag","asc","u","newbuffer","tagfromlist","taguser","render","filteredUsers","display","filterStyle","padding","backgroundColor","height","justifyContent","alignItems","somemargin","textAlign","width","float","ownProps","getUserInterests","mapDispatchToProps","dispatch","navigateTo"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport { Range } from 'rc-slider';\nimport Select from 'react-select';\nimport { GetUserIntrests } from '../../../store/actions/intrestsActions/GetAllInterestsAction';\nimport { connect } from \"react-redux\";\nimport { push } from \"react-router-redux\";\nimport ResultUser from './../Dashboard/ResultUser';\nimport sort from 'fast-sort';\n\nexport class SuggestionList extends Component {\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            sortBy: 'age',\n            lowerBound: 18,\n            upperBound: 75,\n            value: [18, 75],\n            SearchBar: '',\n            rangeFame: 0,\n            rangeLocalisation: 10000,\n            SearchBarTags: '',\n            interestsArray: [],\n            selectedOption: [],\n            location: \"\",\n            initialUsers: this.props.users,\n            userBuffer: []\n        }\n\n        this.handleUsersFilter = this.handleUsersFilter.bind(this);\n        this.onChange = this.onChange.bind(this);\n        this.handleSelectChange = this.handleSelectChange.bind(this);\n    }\n\n\n    async handleUsersFilter(e) {\n        e.preventDefault();\n        let filter = [{\n            userPos: this.state.location,\n            rangeFame: this.state.rangeFame,\n            age: this.state.value,\n            interests: this.state.selectedOption,\n            rangeLocalisation: parseInt(this.state.rangeLocalisation)\n        }]\n\n        await this.props.onfetchAllUsersPublicData(filter);\n    }\n\n    onLowerBoundChange = (e) => {\n        this.setState({ lowerBound: +e.target.value });\n    }\n    onUpperBoundChange = (e) => {\n        this.setState({ upperBound: +e.target.value });\n    }\n    onSliderChange = async (value) => {\n        this.setState({\n            value,\n        });\n        await this.filterUsers();\n        // console.log(this.state.value);\n    }\n    handleApply = () => {\n        const { lowerBound, upperBound } = this.state;\n        this.setState({ value: [lowerBound, upperBound] });\n    }\n\n    handleSelectChange = selectedOption => {\n        this.setState(\n            { selectedOption },\n        );\n        setTimeout(async () => {\n            await this.filterUsers();\n        }, 50);\n    };\n\n    onChange = async (e) => {\n        if (e.target.name !== 'sortBy'){\n            e.preventDefault();\n        }         \n        this.setState({ [e.target.name]: e.target.value })\n\n        setTimeout(async () => {\n            await this.filterUsers();\n        }, 50);\n        // await this.filterUsers();\n        // console.log(this.state[e.target.name]);\n\n    }\n\n    async UNSAFE_componentWillMount() {\n        const userId = localStorage.getItem(\"userId\");\n        this.setState({interestsArray: this.props.interestsArray})\n        await this.props.onGetUserIntrests(userId);\n        await this.filterUsers();\n    }\n\n\n    async filterUsers () {\n\n        let buffer = [];\n        buffer = this.state.initialUsers;\n\n        //FILTER\n        //filter by age\n        var AgeMin = this.state.value[0];\n        var AgeMax = this.state.value[1];\n        var tmpbuff = [];\n        buffer.forEach(user => {\n            if (user.age >= AgeMin && user.age <= AgeMax){\n                tmpbuff.push(user);\n            }\n        });\n        buffer = tmpbuff;\n        //filter by fame\n        var fame = this.state.rangeFame;\n        var tmpbuff = [];\n        buffer.forEach(user => {\n            if (user.fame >= fame){\n                tmpbuff.push(user);\n            }\n        });\n        buffer = tmpbuff;\n        //filter by dist\n        var dist = this.state.rangeLocalisation;\n        var tmpbuff = [];\n        buffer.forEach(user => {\n            if (user.distance <= dist){\n                tmpbuff.push(user);\n            }\n        });\n        buffer = tmpbuff;\n        //filter by interests\n        var tagss = [];\n        var tmpbuff = [];\n        if (this.state.selectedOption !== null){\n            this.state.selectedOption.forEach(element => {\n                tagss.push(element.value);\n            });\n        }\n        if (tagss.length !== 0) {\n            buffer.forEach(element => {\n                element.tags.forEach(tag => {\n                    tagss.forEach(filter_tag => {\n                        if (filter_tag === tag){\n                            tmpbuff.push(element);\n                        }\n                    })\n                })\n            });\n            buffer = tmpbuff;\n        } \n\n        //SORT\n        //sort by fame and age\n        if (this.state.sortBy === 'fame' || this.state.sortBy === 'age'){\n            buffer = sort(buffer).asc(u => u[this.state.sortBy]);\n            this.setState({\n                userBuffer: buffer\n            })\n        //sort by distance\n        } else if(this.state.sortBy === 'location') {\n            buffer = sort(buffer).asc(u => u.distance);\n            this.setState({\n                userBuffer: buffer\n            })\n        //sort by tags\n        } else if (this.state.sortBy === 'tags') {\n            //on a une liste de tags.\n            //on veut que les utilisateurs qui ont le premier element de la liste de tags arrive en premier puis les deuxieme arrive ensuite\n            var tags = [];\n            if (this.state.interestsArray !== null){\n                this.state.interestsArray.forEach(element => {\n                    tags.push(element.value);\n                });\n            }\n            var newbuffer = [];\n            tags.forEach(tagfromlist => {\n                buffer.forEach(element => {\n                    element.tags.forEach(taguser => {\n                        if(taguser === tagfromlist) {\n                            newbuffer.push(element);\n                        }\n                    });\n                });\n            });\n            buffer = newbuffer;\n            this.setState({\n                userBuffer: buffer\n            })\n        }\n    }\n\n    render() {\n\n        let filteredUsers = this.state.userBuffer;\n\n        return (\n            <div>\n                <form style={{ 'marginBottom': '2rem' }}>\n                <div className=\"\" style={{ display: 'flex', 'justifyContent': 'space-around' }}>\n                    <div className=\"\" style={filterStyle}>\n                        <h4>Age</h4>\n                        <p>from {this.state.value[0]} to {this.state.value[1]}</p>\n                        {/* <p>from {this.state.rangeAgeFrom} years old</p>\n                        <input type=\"range\" className=\"custom-range\" id=\"rangeAgeFrom\" name=\"rangeAgeFrom\" min=\"18\" max=\"79\" value={this.state.rangeAgeFrom} onChange={this.onChange} />\n                        <p>to {this.state.rangeAgeTo} years old</p>\n                        <input type=\"range\" className=\"custom-range\" id=\"rangeAgeTo\" name=\"rangeAgeTo\" min=\"19\" max=\"80\" value={this.state.rangeAgeTo} onChange={this.onChange} /> */}\n                        <Range allowCross={false} value={this.state.value} onChange={this.onSliderChange} />\n\n                        <h4>Fame</h4>\n                        <p>search users above {this.state.rangeFame} Fame</p>\n                        <input type=\"range\" className=\"custom-range\" id=\"rangeFame\" name=\"rangeFame\" min=\"0\" max=\"100\" value={this.state.rangeFame} onChange={this.onChange} />\n                    </div>\n                    <div className=\"\" style={filterStyle}>\n                        <h4>Localisation</h4>\n                        <p>search users {this.state.rangeLocalisation}km{`${this.state.rangeLocalisation > 1 ? 's' : ''}`} from you</p>\n                        <input type=\"range\" className=\"custom-range\" id=\"rangeLocalisation\" name=\"rangeLocalisation\" min=\"1\" max=\"10000\" value={this.state.rangeLocalisation} onChange={this.onChange} />\n                        <h4>Interests</h4>\n                            <Select\n                                isMulti\n                                isSearchable\n                                placeholder=\"Filter interests\"\n                                value={this.state.selectedOption}\n                                onChange={this.handleSelectChange}\n                                options={this.state.interestsArray}\n                            />\n                    </div>\n                </div>\n                <div style={{ padding: '2rem'}}>\n                    <div style={{backgroundColor: 'grey', height: '2rem', display: 'flex', justifyContent: 'center', alignItems: 'center'}}> <h4>SORT BY</h4></div>\n                    <div style={{backgroundColor: 'grey', height: '5rem', display: 'flex', justifyContent: 'center', alignItems: 'center'}}>\n                        <div style={somemargin}>\n                            <div>Age</div>\n                            <input type=\"radio\" name=\"sortBy\" value=\"age\" checked={this.state.sortBy === 'age'} onChange={this.onChange}/>\n                        </div>\n                        <div style={somemargin}>\n                            <div>Distance</div>\n                            <input type=\"radio\" name=\"sortBy\" value=\"location\" checked={this.state.sortBy === 'location'} onChange={this.onChange}/>\n                        </div>\n                        <div style={somemargin}>\n                            <div>Tags</div>\n                            <input type=\"radio\" name=\"sortBy\" value=\"tags\" checked={this.state.sortBy === 'tags'} onChange={this.onChange}/>\n                        </div>\n                        <div style={somemargin}>\n                            <div>Fame</div>\n                            <input type=\"radio\" name=\"sortBy\" value=\"fame\" checked={this.state.sortBy === 'fame'} onChange={this.onChange}/>\n                        </div>\n                    </div>\n                    \n                </div>\n            </form>\n            <ResultUser users={filteredUsers}/>\n            </div>\n            \n        )\n    }\n}\n\nconst somemargin = { textAlign: 'center', width: '24%'}\n\nconst filterStyle = {\n    width: '45%',\n    float: 'left',\n    padding: '1rem',\n    'backgroundColor': 'lightgray',\n    'marginTop': '2rem'\n};\n\nconst state = (state, ownProps = {}) => {\n    return {\n        getUserInterests: state.getUserInterests.getUserInterests\n    }\n}\n\nconst mapDispatchToProps = (dispatch, ownProps) => {\n    return {\n        navigateTo: (location) => {\n            dispatch(push(location));\n        },\n        onGetUserIntrests: (userId) => dispatch(GetUserIntrests(userId))\n    }\n};\n\nexport default connect(\n    state,\n    mapDispatchToProps\n)(SuggestionList);\n"]},"metadata":{},"sourceType":"module"}