{"ast":null,"code":"import _regeneratorRuntime from\"/home/abn/my-projects/matcha-42/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/abn/my-projects/matcha-42/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import axios from\"axios/index\";import{FETCH_ALL_USERS_PUBLIC_DATA}from'../ActionType';function deg2rad(deg){return deg*(Math.PI/180);}function getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2){var R=6371;// Radius of the earth in km\nvar dLat=deg2rad(lat2-lat1);// deg2rad below\nvar dLon=deg2rad(lon2-lon1);var a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(deg2rad(lat1))*Math.cos(deg2rad(lat2))*Math.sin(dLon/2)*Math.sin(dLon/2);var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));var d=R*c;// Distance in km\nreturn d;}function CalculateDistance(userPos,userList){var distance_array=[];var userXY=userPos.split(',');var elementXY=[];var dist=0;userList.forEach(function(element){elementXY=element.localisation.split(',');dist=getDistanceFromLatLonInKm(userXY[0],userXY[1],elementXY[0],elementXY[1]);distance_array[element.id]={id:element.id,dist:dist};});return distance_array;}function filter_fame(userList,rangeFame){var id_list=[];userList.forEach(function(element){if(parseInt(element.fame)>=parseInt(rangeFame)){id_list.push(element.id);}});return id_list;}function filter_age(userList,age){var id_list=[];userList.forEach(function(element){if(parseInt(element.age)>=parseInt(age[0])&&parseInt(element.age)<=parseInt(age[1])){id_list.push(element.id);}});return id_list;}function filter_tags(userList,tags){var id_list=[];if(tags.length===0){userList.forEach(function(element){id_list.push(element.id);});}else{userList.forEach(function(element){element.tags.forEach(function(tag){tags.forEach(function(filter_tag){if(filter_tag===tag){id_list.push(element.id);}});});});}return id_list;}function filter_dist(array,dist){var id_list=[];array.forEach(function(element){if(element.dist<=dist){id_list.push(element.id);}});return id_list;}function intersection(){var result=[];var lists;if(arguments.length===1){lists=arguments[0];}else{lists=arguments;}for(var i=0;i<lists.length;i++){var currentList=lists[i];for(var y=0;y<currentList.length;y++){var currentValue=currentList[y];if(result.indexOf(currentValue)===-1){var existsInAll=true;for(var x=0;x<lists.length;x++){if(lists[x].indexOf(currentValue)===-1){existsInAll=false;break;}}if(existsInAll){result.push(currentValue);}}}}return result;}function applyFilteronUser(_x,_x2){return _applyFilteronUser.apply(this,arguments);}function _applyFilteronUser(){_applyFilteronUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(usersList,filter){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt(\"return\",new Promise(function(resolve,reject){// console.log(\"User list : \", usersList);\n// console.log(\"filter :\", filter);\nvar tag_array=[];if(filter[0].interests!==null){filter[0].interests.forEach(function(element){tag_array.push(element.value);});}if(usersList.code===200){var filteredUser=[];var IdsFilteredByFame=filter_fame(usersList.data,filter[0].rangeFame);var IdsFilteredByAge=filter_age(usersList.data,filter[0].age);var IdsFilteredByTags=filter_tags(usersList.data,tag_array);var UserDists=CalculateDistance(filter[0].userPos,usersList.data);var IdsFilteredByDist=filter_dist(UserDists,filter[0].rangeLocalisation);var IdsFiltered=intersection(IdsFilteredByFame,IdsFilteredByAge,IdsFilteredByTags,IdsFilteredByDist);usersList.data.forEach(function(element){IdsFiltered.forEach(function(id){if(parseInt(element.id)===parseInt(id)){UserDists.forEach(function(dist){if(dist.id===element.id){element.distance=dist.dist;}});filteredUser.push(element);}});});resolve(filteredUser);}else{resolve([]);}}));case 1:case\"end\":return _context2.stop();}}},_callee2);}));return _applyFilteronUser.apply(this,arguments);}function IdsFilteredBySexefunc(_x3,_x4){return _IdsFilteredBySexefunc.apply(this,arguments);}function _IdsFilteredBySexefunc(){_IdsFilteredBySexefunc=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(userList,wants){var id_list;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:id_list=[];// console.log(wants);\nif(wants==='B'){userList.forEach(function(element){return id_list.push(element.id);});}else{userList.forEach(function(element){if(element.gender===wants){id_list.push(element.id);}});}return _context3.abrupt(\"return\",id_list);case 3:case\"end\":return _context3.stop();}}},_callee3);}));return _IdsFilteredBySexefunc.apply(this,arguments);}function IdsThatAreInA6000KmRadiusfunc(_x5,_x6){return _IdsThatAreInA6000KmRadiusfunc.apply(this,arguments);}function _IdsThatAreInA6000KmRadiusfunc(){_IdsThatAreInA6000KmRadiusfunc=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(array,dist){var id_list;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:id_list=[];array.forEach(function(element){if(element.dist<=dist){id_list.push(element.id);}});return _context4.abrupt(\"return\",id_list);case 3:case\"end\":return _context4.stop();}}},_callee4);}));return _IdsThatAreInA6000KmRadiusfunc.apply(this,arguments);}function IdsTharAreInA30FameRadiusfunc(_x7,_x8){return _IdsTharAreInA30FameRadiusfunc.apply(this,arguments);}function _IdsTharAreInA30FameRadiusfunc(){_IdsTharAreInA30FameRadiusfunc=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(userList,rangeFame){var id_list,minRange,maxRange;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:id_list=[];minRange=parseInt(rangeFame)-30;maxRange=parseInt(rangeFame)+30;userList.forEach(function(element){if(parseInt(element.fame)>minRange&&parseInt(element.fame)<maxRange){id_list.push(element.id);}});return _context5.abrupt(\"return\",id_list);case 5:case\"end\":return _context5.stop();}}},_callee5);}));return _IdsTharAreInA30FameRadiusfunc.apply(this,arguments);}function applySuggestiononUsers(_x9,_x10){return _applySuggestiononUsers.apply(this,arguments);}function _applySuggestiononUsers(){_applySuggestiononUsers=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(userList,filter){return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:return _context7.abrupt(\"return\",new Promise(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(resolve,reject){var filteredUser,IdsFilteredBySexe,UserDists,IdsThatAreInA6000KmRadius,IdsThatHaveAtLeast1TaginCommon,IdsTharAreInA30FameRadius,IdsFiltered;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(!(userList.code===200)){_context6.next=18;break;}// console.log(userList.data);\n// console.log(filter);\nfilteredUser=[];_context6.next=4;return IdsFilteredBySexefunc(userList.data,filter.wants);case 4:IdsFilteredBySexe=_context6.sent;// console.log(IdsFilteredBySexe);\nUserDists=CalculateDistance(filter.location,userList.data);// console.log(UserDists);\n_context6.next=8;return IdsThatAreInA6000KmRadiusfunc(UserDists,10000);case 8:IdsThatAreInA6000KmRadius=_context6.sent;// console.log(IdsThatAreInA6000KmRadius);\nIdsThatHaveAtLeast1TaginCommon=filter_tags(userList.data,filter.tags);// console.log(IdsThatHaveAtLeast1TaginCommon);\n_context6.next=12;return IdsTharAreInA30FameRadiusfunc(userList.data,filter.fame);case 12:IdsTharAreInA30FameRadius=_context6.sent;// console.log(IdsTharAreInA30FameRadius);\nIdsFiltered=intersection(IdsFilteredBySexe,IdsThatAreInA6000KmRadius,IdsThatHaveAtLeast1TaginCommon,IdsTharAreInA30FameRadius);// console.log('result', IdsFiltered);\nuserList.data.forEach(function(element){IdsFiltered.forEach(function(id){if(parseInt(element.id)===parseInt(id)){UserDists.forEach(function(dist){if(dist.id===element.id){element.distance=dist.dist;}});filteredUser.push(element);}});});resolve(filteredUser);_context6.next=19;break;case 18:resolve([]);case 19:case\"end\":return _context6.stop();}}},_callee6);}));return function(_x17,_x18){return _ref2.apply(this,arguments);};}()));case 1:case\"end\":return _context7.stop();}}},_callee7);}));return _applySuggestiononUsers.apply(this,arguments);}function AddDistance(_x11){return _AddDistance.apply(this,arguments);}function _AddDistance(){_AddDistance=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(userList){return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:return _context9.abrupt(\"return\",new Promise(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(resolve,reject){var UserDists;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:if(userList.code===200){UserDists=CalculateDistance('48.8543,2.3527',userList.data);userList.data.forEach(function(element){UserDists.forEach(function(dist){if(dist.id===element.id){element.distance=dist.dist;}});});resolve(userList.data);}else{resolve([]);}case 1:case\"end\":return _context8.stop();}}},_callee8);}));return function(_x19,_x20){return _ref3.apply(this,arguments);};}()));case 1:case\"end\":return _context9.stop();}}},_callee9);}));return _AddDistance.apply(this,arguments);}function UsersPublicData(_x12,_x13,_x14,_x15){return _UsersPublicData.apply(this,arguments);}function _UsersPublicData(){_UsersPublicData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11(filter,token,userId,dispatch){return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:axios.get(process.env.REACT_APP_API_URL+\"/users/publicData/\"+userId,{headers:{\"Authorization\":\"Bearer \".concat(token)}}).then(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(results){return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:if(!(filter.length===0)){_context10.next=11;break;}_context10.t0=dispatch;_context10.t1=FETCH_ALL_USERS_PUBLIC_DATA;_context10.next=5;return AddDistance(results.data);case 5:_context10.t2=_context10.sent;_context10.t3={data:_context10.t2,code:200};_context10.t4={type:_context10.t1,payload:_context10.t3};(0,_context10.t0)(_context10.t4);_context10.next=30;break;case 11:if(!filter.hasOwnProperty('Suggestion')){_context10.next=22;break;}_context10.t5=dispatch;_context10.t6=FETCH_ALL_USERS_PUBLIC_DATA;_context10.next=16;return applySuggestiononUsers(results.data,filter);case 16:_context10.t7=_context10.sent;_context10.t8={data:_context10.t7,code:200};_context10.t9={type:_context10.t6,payload:_context10.t8};(0,_context10.t5)(_context10.t9);_context10.next=30;break;case 22:_context10.t10=dispatch;_context10.t11=FETCH_ALL_USERS_PUBLIC_DATA;_context10.next=26;return applyFilteronUser(results.data,filter);case 26:_context10.t12=_context10.sent;_context10.t13={data:_context10.t12,code:200};_context10.t14={type:_context10.t11,payload:_context10.t13};(0,_context10.t10)(_context10.t14);case 30:case\"end\":return _context10.stop();}}},_callee10);}));return function(_x21){return _ref4.apply(this,arguments);};}()).catch(function(err){dispatch({type:FETCH_ALL_USERS_PUBLIC_DATA,payload:false});});case 1:case\"end\":return _context11.stop();}}},_callee11);}));return _UsersPublicData.apply(this,arguments);}export function fetchAllUsersPublicData(filter){var token=localStorage.getItem(\"token\");var userId=localStorage.getItem(\"userId\");return(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return UsersPublicData(filter,token,userId,dispatch);case 2:case\"end\":return _context.stop();}}},_callee);}));return function(_x16){return _ref.apply(this,arguments);};}());}","map":{"version":3,"sources":["/home/abn/my-projects/matcha-42/frontend/src/store/actions/UsersActions/fetchAllUsersPublicDataAction.js"],"names":["axios","FETCH_ALL_USERS_PUBLIC_DATA","deg2rad","deg","Math","PI","getDistanceFromLatLonInKm","lat1","lon1","lat2","lon2","R","dLat","dLon","a","sin","cos","c","atan2","sqrt","d","CalculateDistance","userPos","userList","distance_array","userXY","split","elementXY","dist","forEach","element","localisation","id","filter_fame","rangeFame","id_list","parseInt","fame","push","filter_age","age","filter_tags","tags","length","tag","filter_tag","filter_dist","array","intersection","result","lists","arguments","i","currentList","y","currentValue","indexOf","existsInAll","x","applyFilteronUser","usersList","filter","Promise","resolve","reject","tag_array","interests","value","code","filteredUser","IdsFilteredByFame","data","IdsFilteredByAge","IdsFilteredByTags","UserDists","IdsFilteredByDist","rangeLocalisation","IdsFiltered","distance","IdsFilteredBySexefunc","wants","gender","IdsThatAreInA6000KmRadiusfunc","IdsTharAreInA30FameRadiusfunc","minRange","maxRange","applySuggestiononUsers","IdsFilteredBySexe","location","IdsThatAreInA6000KmRadius","IdsThatHaveAtLeast1TaginCommon","IdsTharAreInA30FameRadius","AddDistance","UsersPublicData","token","userId","dispatch","get","process","env","REACT_APP_API_URL","headers","then","results","type","payload","hasOwnProperty","catch","err","fetchAllUsersPublicData","localStorage","getItem"],"mappings":"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","sourcesContent":["import axios from \"axios/index\";\n\nimport {\n    FETCH_ALL_USERS_PUBLIC_DATA\n} from '../ActionType';\n\nfunction deg2rad(deg) {\n    return deg * (Math.PI/180)\n}\n\nfunction getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {\n    var R = 6371; // Radius of the earth in km\n    var dLat = deg2rad(lat2-lat1);  // deg2rad below\n    var dLon = deg2rad(lon2-lon1); \n    var a = \n      Math.sin(dLat/2) * Math.sin(dLat/2) +\n      Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * \n      Math.sin(dLon/2) * Math.sin(dLon/2)\n      ; \n    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); \n    var d = R * c; // Distance in km\n    return d;\n  }\n\nfunction CalculateDistance (userPos, userList){\n\n    var distance_array = [];\n    var userXY = userPos.split(',');\n    var elementXY = [];\n    var dist = 0;\n\n    userList.forEach(element => {\n        elementXY = element.localisation.split(',');\n        dist = getDistanceFromLatLonInKm(userXY[0], userXY[1], elementXY[0], elementXY[1]);\n        distance_array[element.id] = {\n            id: element.id,\n            dist: dist\n        }\n    });\n\n    return(distance_array);\n}\n\nfunction filter_fame (userList, rangeFame) {\n    var id_list = [];\n    userList.forEach(element => {\n        if (parseInt(element.fame) >= parseInt(rangeFame)) {\n            id_list.push(element.id);\n        }  \n    });\n    return (id_list)\n} \n\nfunction filter_age (userList, age) {\n    var id_list = [];\n    userList.forEach(element => {\n        if (parseInt(element.age) >= parseInt(age[0]) && parseInt(element.age) <= parseInt(age[1])) {\n            id_list.push(element.id);\n        }  \n    });\n    return (id_list)\n}\n\nfunction filter_tags (userList, tags) {\n    var id_list = [];\n    if (tags.length === 0){\n        userList.forEach(element => {\n            id_list.push(element.id);\n        })\n    } else {\n        userList.forEach(element => {\n            element.tags.forEach(tag => {\n                tags.forEach(filter_tag => {\n                    if (filter_tag === tag){\n                        id_list.push(element.id);\n                    }\n                })\n            })\n        });\n    }\n    return (id_list)\n}\n\nfunction filter_dist (array, dist){\n    var id_list = [];\n    array.forEach(element => {\n        if (element.dist <= dist){\n            id_list.push(element.id);\n        }\n    });\n    return(id_list);\n}\n\nfunction intersection() {\n    var result = [];\n    var lists;\n  \n    if(arguments.length === 1) {\n      lists = arguments[0];\n    } else {\n      lists = arguments;\n    }\n  \n    for(var i = 0; i < lists.length; i++) {\n      var currentList = lists[i];\n      for(var y = 0; y < currentList.length; y++) {\n          var currentValue = currentList[y];\n        if(result.indexOf(currentValue) === -1) {\n          var existsInAll = true;\n          for(var x = 0; x < lists.length; x++) {\n            if(lists[x].indexOf(currentValue) === -1) {\n              existsInAll = false;\n              break;\n            }\n          }\n          if(existsInAll) {\n            result.push(currentValue);\n          }\n        }\n      }\n    }\n    return result;\n  }\n\nasync function applyFilteronUser(usersList, filter) {\n    return new Promise((resolve, reject) => {\n        // console.log(\"User list : \", usersList);\n        // console.log(\"filter :\", filter);\n        var tag_array = [];\n        if (filter[0].interests !== null){\n            filter[0].interests.forEach(element => {\n                tag_array.push(element.value);\n            });\n        }\n\n        if (usersList.code === 200){\n            var filteredUser = [];\n\n            var IdsFilteredByFame = filter_fame(usersList.data, filter[0].rangeFame)\n            var IdsFilteredByAge = filter_age(usersList.data, filter[0].age)\n            var IdsFilteredByTags = filter_tags(usersList.data, tag_array)\n            \n            var UserDists = CalculateDistance(filter[0].userPos, usersList.data);\n\n            var IdsFilteredByDist = filter_dist(UserDists, filter[0].rangeLocalisation)\n\n            var IdsFiltered = intersection(IdsFilteredByFame, IdsFilteredByAge, IdsFilteredByTags, IdsFilteredByDist);\n\n            usersList.data.forEach(element => {\n                IdsFiltered.forEach(id => {\n                    if (parseInt(element.id) === parseInt(id)) {\n                        UserDists.forEach(dist => {\n                            if (dist.id === element.id){\n                                element.distance = dist.dist;\n                            }\n                        });\n                        filteredUser.push(element);\n                    }\n                });\n            });\n            resolve(filteredUser);\n        } else {\n            resolve([]);\n        }\n    })\n}\n\nasync function IdsFilteredBySexefunc(userList, wants){\n    var id_list = [];\n    // console.log(wants);\n    if (wants === 'B'){\n        userList.forEach(element => id_list.push(element.id));\n    } else {\n        userList.forEach(element => {\n            if (element.gender === wants) {\n                id_list.push(element.id);\n            }  \n        });\n    }\n    return (id_list)\n}\n\nasync function IdsThatAreInA6000KmRadiusfunc(array, dist) {\n    var id_list = [];\n    array.forEach(element => {\n        if (element.dist <= dist){\n            id_list.push(element.id);\n        }\n    });\n    return(id_list);\n}\n\nasync function IdsTharAreInA30FameRadiusfunc(userList, rangeFame){\n    var id_list = [];\n    var minRange = parseInt(rangeFame) - 30;\n    var maxRange = parseInt(rangeFame) + 30;\n    userList.forEach(element => {\n        if (parseInt(element.fame) > minRange && parseInt(element.fame) < maxRange) {\n            id_list.push(element.id);\n        }  \n    });\n    return (id_list)\n}\n\nasync function applySuggestiononUsers(userList, filter){\n    return new Promise(async (resolve, reject) => {\n        if (userList.code === 200) {\n            // console.log(userList.data);\n            // console.log(filter);\n            var filteredUser = [];\n\n            let IdsFilteredBySexe = await IdsFilteredBySexefunc(userList.data, filter.wants);\n            // console.log(IdsFilteredBySexe);\n\n            var UserDists = CalculateDistance(filter.location, userList.data);\n            // console.log(UserDists);\n\n            let IdsThatAreInA6000KmRadius = await IdsThatAreInA6000KmRadiusfunc(UserDists, 10000);\n            // console.log(IdsThatAreInA6000KmRadius);\n            let IdsThatHaveAtLeast1TaginCommon = filter_tags(userList.data, filter.tags);\n            // console.log(IdsThatHaveAtLeast1TaginCommon);\n            let IdsTharAreInA30FameRadius = await IdsTharAreInA30FameRadiusfunc(userList.data, filter.fame);\n            // console.log(IdsTharAreInA30FameRadius);\n\n            var IdsFiltered = intersection(IdsFilteredBySexe, IdsThatAreInA6000KmRadius, IdsThatHaveAtLeast1TaginCommon, IdsTharAreInA30FameRadius);\n            // console.log('result', IdsFiltered);\n            \n            userList.data.forEach(element => {\n                IdsFiltered.forEach(id => {\n                    if (parseInt(element.id) === parseInt(id)) {\n                        UserDists.forEach(dist => {\n                            if (dist.id === element.id){\n                                element.distance = dist.dist;\n                            }\n                        });\n                        filteredUser.push(element);\n                    }\n                });\n            });\n            resolve(filteredUser)\n        } else {\n            resolve([]);\n        }\n    })\n}\n\nasync function AddDistance(userList) {\n    return new Promise(async (resolve, reject) => {\n        if (userList.code === 200) {\n            var UserDists = CalculateDistance('48.8543,2.3527', userList.data);\n\n            userList.data.forEach(element => {\n                UserDists.forEach(dist => {\n                    if(dist.id === element.id) {\n                        element.distance = dist.dist;\n                    }\n                });\n            })\n            resolve(userList.data);\n        } else {\n            resolve([]);\n        }\n    })\n}\n\nasync function UsersPublicData(filter, token, userId, dispatch) {\n    axios.get(process.env.REACT_APP_API_URL + \"/users/publicData/\" + userId, {\n        headers: {\n            \"Authorization\": `Bearer ${token}`\n        }\n    })\n        .then(async results => {\n            if (filter.length === 0)\n                dispatch({\n                    type: FETCH_ALL_USERS_PUBLIC_DATA,\n                    payload: {\n                        data: await AddDistance(results.data),\n                        code: 200\n                    }\n                })\n            else {\n                if (filter.hasOwnProperty('Suggestion') ){\n                    dispatch({\n                        type: FETCH_ALL_USERS_PUBLIC_DATA,\n                        payload: {\n                            data: await applySuggestiononUsers(results.data, filter),\n                            code: 200\n                        }\n                    })\n                } else {\n                    dispatch({\n                        type: FETCH_ALL_USERS_PUBLIC_DATA,\n                        payload: {\n                            data: await applyFilteronUser(results.data, filter),\n                            code: 200\n                        }\n                    })\n                }\n            }\n\n        })\n        .catch(err => {\n            dispatch({\n                type: FETCH_ALL_USERS_PUBLIC_DATA,\n                payload: false\n            })\n        })\n}\n\nexport function fetchAllUsersPublicData(filter) {\n    const token = localStorage.getItem(\"token\");\n    const userId = localStorage.getItem(\"userId\");\n\n    return async function (dispatch) {\n        await UsersPublicData(filter, token, userId, dispatch);\n    }\n}"]},"metadata":{},"sourceType":"module"}